---
config:
  layout: elk
  theme: neutral
---
flowchart TB
  subgraph LEGEND["Legend"]
        L1["LG-001 | Phase 1 (Yellow release)"]
        L2["LG-002 | Phase 2 (Orange release)"]
  end

  subgraph CALEDONIA["Canada returns routed to Caledonia"]
        R1["WF-090 | Return delivered to Caledonia"]
        R2["WF-091 | Caledonia team updates return status in portal (limited access role)"]
        R4["WF-092 | Update status: Delivered → Processing / Inspection Completed"]
        R5@{ label: "WF-093 | Store Ops run 'Returned items' report for inventory update" }
  end

    %% ---------------------------------------------------------
    %% ENTRY POINT – PURCHASE CHANNEL SELECTION
    %% WF-002, WF-003, WF-004 are parallel workstreams
    %% ---------------------------------------------------------
    A["WF-001 | Where did you purchase?"] --> Online["WF-002 | Silk & Snow Online – CA / US (WooCommerce)"] & Retail["WF-003 | Silk & Snow Retail Store (in-person)"] & D["WF-004 | Third-party vendor: TSC, EQ3, Costco"]

    %% Online workstream
    Online --> B["WF-020 | Orders in Shopify (Online + Shopify POS)"]

    %% Retail workstream
    Retail --> RS1["WF-018 | Select the store you purchased from"]

    %% Third-party vendor workstream
    D --> TP0["WF-005 | Select third-party vendor (TSC, EQ3, Costco)"]
    TP0 --> TP1["WF-006 | Collect required evidence (receipt, photos, law tags, other)"]
    TP1 --> TP2["WF-007 | Log action item in ClaimLane: Third-party vendor review required"]
    TP2 --> TP3["WF-008 | Send email notification to vendor (ticket created)"]
    TP3 --> TP4{"WF-009 | Vendor approves to proceed?"}
    TP4 -- No --> TP5["WF-010 | Vendor declines: Communicate decision + next steps to customer"]
    TP5 --> FinalProcess["WF-060 | Close case / completion"]
    TP4 -- Yes --> TP6{"WF-011 | Does customer need pickup assistance?"}
    TP6 -- Yes --> TP7["WF-012 | CX provides pickup assistance (coordination + guidance)"]
    TP6 -- No --> TP8["WF-013 | Customer proceeds with vendor instructions (no CX pickup coordination)"]
    TP7 --> TP9["WF-014 | Pickup confirmed / scheduled"]
    TP8 --> TP9
    TP9 --> TP10["WF-015 | Item received (confirm receipt)"]
    TP10 --> R1 & TP11["WF-016 | Email vendor: Proceed with return / refund"]
    TP11 --> FinalProcess
    TP1 -.-> TP_NOTE["WF-017 | Note: Exact evidence requirements to be confirmed per vendor (TSC/EQ3)."]

    RS1 --> RS2{"WF-019 | Store backend (system lookup)"}
    RS2 -- Shopify POS store --> B
    RS2 -- "STORIS (non-Shopify) store" --> RS3["WF-021 | Message: This store handles returns in person only (no online processing)"]
    RS3 --> RSEnd["WF-022 | End – customer must visit store to complete return"]

    B --> B0["WF-023 | What do you need help with?"]
    B0 --> BR["WF-024 | Return"] & BW["WF-025 | Warranty claim"]

    BR --> OR1["WF-026 | Enter order number and email"]
    OR1 --> OR2{"WF-027 | Order validated?"}
    OR2 -- No --> OR2N["WF-028 | Show error and allow retry or contact support"]
    OR2 -- Yes --> OR3["WF-029 | Display all items in order"]
    OR3 --> OR4["WF-030 | Customer selects one or more items to return"]
    OR4 --> SPLIT_PROMO["WF-031 | Run promotion checks (in parallel)"]
    SPLIT_PROMO --> BND10{"WF-032 | Free item included with selected items?"} & BND12{"WF-033 | Selected items part of a discounted bundle?"}
    BND10 -- Yes --> BND11["WF-034 | Prompt: Free item can be kept at 50% of original price"]
    BND10 -- No --> JOIN_PROMO["WF-036 | Promotion checks complete"]
    BND12 -- Yes --> BND13["WF-035 | Prompt: Returning items may remove the bundle discount applied to the order"]
    BND12 -- No --> JOIN_PROMO
    BND11 --> JOIN_PROMO
    BND13 --> JOIN_PROMO
    BND11 -.-> BND_NOTE["WF-037 | Note: Prompts are required because refund amounts are not shown during the journey. Messaging sets expectations for pricing and discount impacts before proceeding."]
    BND13 -.-> BND_NOTE
    JOIN_PROMO --> OR5{"WF-038 | Item type selected"}

    OR5 -- Mattress --> M2{"WF-039 | Is mattress boxed?"}
    OR5 -- Furniture --> F1["WF-040 | Furniture return"]
    OR5 -- Accessory/Bedding --> A1["WF-041 | Accessory / Bedding return"]

    BW --> OW1["WF-042 | Enter order number and email"]
    OW1 --> OW2{"WF-043 | Order validated?"}
    OW2 -- No --> OW2N["WF-044 | Show error and allow retry or contact support"]

    OW2 -- Yes --> PHDEC{"WF-045 | Which release is live?"}

    PHDEC -- Phase 1 (Yellow) --> P1UNK["WF-046 | TBD: Phase 1 warranty intake steps to be confirmed (CX ticketing / responsibilities)"]
    P1UNK --> P1W["WF-047 | Log action item: Return Logistics to select donation / pickup vendor"]
    P1W --> P1E["WF-048 | Trigger emails: vendor + customer"]
    P1E --> P1C{"WF-049 | Change vendor?"}
    P1C -- Yes --> P1N["WF-050 | Select new vendor → trigger updated emails"]
    P1C -- No --> P1P["WF-051 | Vendor picks up item and marks Picked"]
    P1N --> P1P
    P1P --> Received["WF-089 | Item marked Received in portal"]

    PHDEC -- Phase 2 (Orange) --> OW3["WF-052 | Display all items in the order (include replacement parts where applicable)"]
    OW3 -.-> WRP_NOTE@{ label: "WF-052A | Note: Replacement parts should be shown with product context<br><br><p data-start=\"186\" data-end=\"272\"><strong data-start=\"186\" data-end=\"239\">Example – Nara Wooden Dresser (5-Drawer, Cortado)</strong><br data-start=\"239\" data-end=\"242\"><br>Parent SKU: <strong data-start=\"254\" data-end=\"270\">SNSFNDR5005T</strong></p><ul data-start=\"273\" data-end=\"488\"><li data-start=\"273\" data-end=\"313\"><p data-start=\"275\" data-end=\"313\">Drawer – Top Left | SNSFNDR5005TDRSL</p></li><li data-start=\"314\" data-end=\"355\"><p data-start=\"316\" data-end=\"355\">Drawer – Top Right | SNSFNDR5005TDRSR</p></li><li data-start=\"356\" data-end=\"392\"><p data-start=\"358\" data-end=\"392\">Drawer – Large | SNSFNDR5005TDRB</p></li><li data-start=\"393\" data-end=\"418\"><p data-start=\"395\" data-end=\"418\">Screw | SNSFNS5000TSW</p></li><li data-start=\"419\" data-end=\"454\"><p data-start=\"421\" data-end=\"454\">Stain &amp; Brush | SNSFNWO5000ACST</p></li><li data-start=\"455\" data-end=\"488\"><p data-start=\"457\" data-end=\"488\">Stain &amp; Brush | SNSFNS5000TST</p></li></ul>" }

    OW3 --> OW4["WF-053 | Customer selects an item or replacement part (sub-part)"]
    OW4 --> WInfo["WF-054 | Collect additional info: issue description, photos, pickup assistance needed, pickup date, address confirmation"]
    WInfo --> WCL["WF-055 | Submit warranty case to ClaimLane (selected part SKUs + evidence + notes)"]
    WCL --> WCX["WF-056 | CX places replacement order in WooCommerce (based on selected replacement part SKUs)"]
    WCX --> WPUQ{"WF-057 | Does customer need pickup assistance?"}
    WPUQ -- No --> WClose["WF-058 | Close case after replacement order is placed (status updates + customer comms)"]
    WClose --> FinalProcess
    WPUQ -- Yes --> WPU1["WF-059 | Log action item: Return Logistics to select donation / pickup vendor (Phase 1 pattern)"]
    WPU1 --> WPU2["WF-061 | Trigger emails: vendor + customer (Phase 1 pattern)"]
    WPU2 --> WPU3{"WF-062 | Change vendor?"}
    WPU3 -- Yes --> WPU4["WF-063 | Select new vendor → trigger updated emails"]
    WPU3 -- No --> WPU5["WF-064 | Vendor picks up item and marks Picked"]
    WPU4 --> WPU5
    WPU5 --> Received

    M2 -- Yes --> MInfo["WF-061A | Collect extra info: tags, lot number, photos, pickup dates"]
    MInfo --> MInstr["WF-062A | Provide return label / pickup details"]
    MInstr --> M3["WF-063A | Vendor picks up mattress and marks Picked"]
    M3 --> Received

    M2 -- No --> MUInfo["WF-064A | Collect extra info: photos, law tag, condition"]
    MUInfo --> U1["WF-065A | Return Logistics: Select donation / pickup vendor"]
    U1 --> U6["WF-066 | Trigger emails: vendor + customer"]
    U6 --> U8{"WF-067A | Change vendor?"}
    U8 -- Yes --> U9["WF-068A | Select new vendor → trigger updated emails"]
    U8 -- No --> M3
    U9 --> M3

    F1 --> FInfoPhotos["WF-069A | Customer uploads photos + issue details"]
    FInfoPhotos --> FCXReview["WF-070A | CX reviews"]
    FCXReview --> FCXApprove{"WF-071A | CX approves?"}
    FCXApprove -- No --> FCXDecline["WF-072A | Communicate decline"]
    FCXDecline --> FinalProcess
    FCXApprove -- Yes --> FInfoDetails["WF-073A | Collect pickup details"]
    FInfoDetails --> FLabelPickup["WF-074A | Generate label + instructions"]
    FLabelPickup --> F3["WF-075A | Arrange pickup"]
    F3 --> Received

    A1 --> AInfo["WF-076A | Collect info"]
    AInfo --> AInstr["WF-077A | Provide mail-in instructions"]
    AInstr --> A2["WF-078A | Customer ships item"]
    A2 --> Received

    Received --> PH1Q{"WF-066B | Is this Phase 1?"}

    PH1Q -- Yes --> RV1{"WF-067 | Return order value < 600 AND order does not contain bundles?"} & R1
    RV1 -- Yes --> AutoRefund["WF-068 | Auto refund"]
    RV1 -- No --> ManualRefund["WF-069 | Manual refund"]
    AutoRefund --> FinalProcess
    ManualRefund --> FinalProcess

    PH1Q -- No --> P2BND["WF-070 | Phase 2: Calculate bundle impacts and adjusted refundable amounts"]
    P2BND --> P2RF{"WF-071 | Auto refund eligible after bundle calculation?"}
    P2RF -- Yes --> P2AutoRefund["WF-072 | Auto refund if order value < 600 (post-bundle calc)"]
    P2RF -- No --> P2ManualRefund["WF-073 | Manual refund (post-bundle calc)"]
    P2AutoRefund --> FinalProcess
    P2ManualRefund --> FinalProcess

    RV1 -.-> CL_BND_NOTE["WF-074 | Note: Due to ClaimLane limitations, Silk & Snow bundle calculations are handled in Phase 2."]
    P2BND -.-> CL_BND_NOTE

    R1 --> R2
    R2 --> R4
    R4 --> R5
    R5 --> FinalProcess

    R5@{ shape: rect}
    WRP_NOTE@{ shape: rect}

     L1:::phase1
     L2:::phase2
     R1:::phase1
     R2:::phase1
     R4:::phase1
     R5:::phase1
     A:::phase1
     Online:::phase1
     Retail:::phase1
     B:::phase1
     D:::phase1
     RS1:::phase1
     TP0:::phase1
     TP1:::phase1
     TP2:::phase1
     TP3:::phase1
     TP4:::phase1
     TP5:::phase1
     FinalProcess:::phase2
     TP6:::phase1
     TP7:::phase1
     TP8:::phase1
     TP9:::phase1
     TP10:::phase1
     TP11:::phase1
     RS2:::phase1
     RS3:::phase1
     RSEnd:::phase1
     B0:::phase1
     BR:::phase1
     BW:::phase1
     OR1:::phase1
     OR2:::phase1
     OR2N:::phase1
     OR3:::phase1
     OR4:::phase1
     SPLIT_PROMO:::phase1
     BND10:::phase1
     BND12:::phase1
     BND11:::phase1
     JOIN_PROMO:::phase1
     BND13:::phase1
     OR5:::phase1
     M2:::phase1
     F1:::phase1
     A1:::phase1
     OW1:::phase1
     OW2:::phase1
     OW2N:::phase1
     PHDEC:::phase1
     P1UNK:::tbd
     P1W:::phase1
     P1E:::phase1
     P1C:::phase1
     P1N:::phase1
     P1P:::phase1
     Received:::phase1
     OW3:::phase2
     OW4:::phase2
     WInfo:::phase2
     WCL:::phase2
     WCX:::phase2
     WPUQ:::phase2
     WClose:::phase2
     WPU1:::phase2
     WPU2:::phase2
     WPU3:::phase2
     WPU4:::phase2
     WPU5:::phase2
     MInfo:::phase1
     MInstr:::phase1
     M3:::phase1
     MUInfo:::phase1
     U1:::phase1
     U6:::phase1
     U8:::phase1
     U9:::phase1
     FInfoPhotos:::phase1
     FCXReview:::phase1
     FCXApprove:::phase1
     FCXDecline:::phase1
     FInfoDetails:::phase1
     FLabelPickup:::phase1
     F3:::phase1
     AInfo:::phase1
     AInstr:::phase1
     A2:::phase1
     PH1Q:::phase1
     RV1:::phase1
     AutoRefund:::phase1
     ManualRefund:::phase1
     P2BND:::phase2
     P2RF:::phase2
     P2AutoRefund:::phase2
     P2ManualRefund:::phase2

     %% Notes in light blue
     TP_NOTE:::note
     BND_NOTE:::note
     WRP_NOTE:::note
     CL_BND_NOTE:::note

    classDef phase1 fill:#FFEB3B,stroke:#B38F00,stroke-width:2px,color:#111
    classDef phase2 fill:#FF9800,stroke:#A85A00,stroke-width:2px,color:#111
    classDef tbd fill:#E0E0E0,stroke:#757575,stroke-width:2px,color:#111
    classDef note fill:#E3F2FD,stroke:#64B5F6,stroke-width:2px,color:#0D47A1

    style CALEDONIA fill:#FFFDE7,stroke:#B38F00,stroke-width:2px
    style LEGEND fill:#FFFFFF,stroke:#999999,stroke-width:1px
